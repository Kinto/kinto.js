language: python
python:
 - "3.5"
env:
  - SERVER=5.1.0 ACTION=test
  - SERVER=master ACTION=test
  - ACTION="run lint"
  - ACTION="run dist"       # ensures building dist files doesn't break
  - ACTION="run build-demo" # ensures building the demo doesn't break
before_install:
  - wget https://raw.githubusercontent.com/creationix/nvm/v0.33.0/nvm.sh -O ~/.nvm/nvm.sh
  - source ~/.nvm/nvm.sh
  - nvm install 6 # for Node v6
  - node --version
  - curl https://raw.githubusercontent.com/Kinto/kinto/$SERVER/requirements.txt -O
  - if [[ $SERVER && $SERVER != master ]]; then pip install kinto==$SERVER --constraint requirements.txt ; fi
  - if [[ $SERVER && $SERVER == master ]]; then pip install https://github.com/Kinto/kinto/zipball/master --constraint requirements.txt; fi
  - export KINTO_PSERVE_EXECUTABLE=pserve
script:
  - npm $ACTION
after_script:
  - npm run report-coverage
